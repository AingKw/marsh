import os
import sys
def stdout(i):
    sys.stdout.write(i) ; sys.stdout.flush()
def unmarshal(file="", out=""):
    ojek = 0
    while True:
        ips = []
        kok = None
        rep = None
        place = None
        cok = False
        kode = open(file).read()
        if "# decompiling error!!!" in kode:
            if os.path.isfile(cache):
                wih = open(cache).read()
                with open(out, mode="w") as load:
                    load.write(wih)
            else:
                pass
            stdout("\r# decompiling error saved to %s\n"%(out))
            break
        if not "exec" in kode:
            stdout("\r# decompiling error, not found exec\n")
            break
        else:
            ojek += 1
            for i in kode.splitlines():
                if i[:4]=="exec":
                    res = i[:4] + i[4]
                    ips.append(i.replace(res, "AingKw="))
                    kok = kode.replace(i, ips[0])
                    break
            if not kok is None:
                magic = "\n# Jangan Lupa Subrek Yt gw ya Bre:)\ntry:\n    __import__('uncompyle6').main.decompile(2.7, AingKw, __import__('sys').stdout)\nexcept (AssertionError):\n    print(AingKw)\nexcept (NameError, KeyError, IndexError, ValueError):\n    print('# decompiling error!!!')\n# Ciya Recode doang lu Bisanya njir >_<\n"
                with open(cache, mode="w") as load:
                    load.write(kok)
                    load.write(magic)
                os.system("python2 %s >%s"%(cache, out))
                stdout("\r# decompiling file object %s "%(str(ojek)))
                file = out
            else:
                    stdout("\r# decompiling done saved to %s\n"%(out))
                    break
    try:
        os.unlink(cache)
    except:pass
cache=".stdin"
try:
    a=sys.argv[1]
except (IndexError):
    a=raw_input("file: ")
try:
    b=sys.argv[2]
except (IndexError):
    b="decompiling-2.7.py"
try:
    unmarshal(a,b)
except (KeyboardInterrupt, EOFError):
    try:
        exit(os.unlink(cache))
    except:pass

